<!DOCTYPE html>
<html>
<head>
	 <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
   <title>问题</title>
   <link href="../../resources/css/bootstrap.min.css" rel="stylesheet">
   <script src="../../resources/js/jquery-1.9.1.js"></script>
   <script src="../../resources/js/bootstrap.min.js"></script>
   <style>
   .navbar{
   		padding-top: 10px;
   }
   	.navbar-default{
   		border: none;
   		background-color: #FFFFFF;
   	}
 a{
 	text-decoration:none;
 }
 a:link{
 	text-decoration:none;
 }
 
.list-group-item{
	height: 50px;
	line-height: 50px;
	padding: 0px;
	margin: 0px;
}

.radioCss{
	width:18px;
	height:18px;
}
input[type="checkbox"], input[type="radio"] {
    line-height: normal;
    margin: 17px 0px 10px 10px;
}
.type {
    float: left;
    width: 40%;
    padding-left: 10%;
}
.type2 {
   text-align: right;
   padding-right: 10%;
} 
.labelFont{
	color: #484848;
	font-weight: bold;
}
   </style>
   
   
</head>
<body>
	    <div class="panel panel-primary" style="border: 0px;" id="content" num="0" pre="0" next="0" now="0" >
				 
		</div>
   
  
<nav class="navbar navbar-default navbar-fixed-bottom">
	      	<div class="type">
				 <button type="button" class="btn btn-primary btn-sm" onclick="changeQuest(-1)" >上一题</button>
	      	</div>
		    <div class="type2">
		    	 <button type="button" class="btn btn-primary btn-sm" onclick="changeQuest(1)">下一题</button>
		    </div>
</nav>

</body>
<script> 

	var dataSource;//数据源
	var answer="";//答案 结果
	init();
      function init(){
    	  $.ajax({
    			url : "/special-web/haining/survey/get/topic",
    			type : 'POST',
    			dataType : 'json',
    			cache : false,
    			success : function(text) {
    				var flag = true;
    				if(text.success){
    					var  data = JSON.parse(text.data); 
    					if(data!=null&&data.success&&data.data.length>0){
    						flag = false;
    						getAllSubject(data.data[0].id);
    					}
    				}
    			},
    			error : function(jqXHR, textStatus, errorThrown) {
    				
    			}
    		});
    	  
      }
      
    	//获取所有题目
      function getAllSubject(topicId){
  		$.ajax({
  			url : "/special-web/haining/survey/get/allSubject",
  			type : 'POST',
  			data:{topicId:topicId},
  			dataType : 'json',
  			cache : false,
  			success : function(text) {
  				var flag = true;
				if(text.success){
					var  data = JSON.parse(text.data); 
					if(data!=null&&data.success&&data.data.length>0){
						flag = false;
						dataSource = data.data;
						getQuest(0);
					}
				}
  			},
  			error : function(jqXHR, textStatus, errorThrown) {
  			}
  		});
  	}
      
	 //所有问题	
	  function getQuest(num){
		  getPanelHtml(num);
	 }
	  //获取题目
	  function getPanelHtml(num){
		var obj = dataSource[num];  
		//设置当前选项ID
		$("#content").attr('now',obj.id);
		
	  	var html  ="";
	  		html += "<div class='panel-heading' align='center'>";
			html +=		"<lable   class='labelFont'>问题"+(num+1)+"<lable>";    	
			html += " </div>";
			html += "<div class='panel-heading' style='background-color: #d9edf7;border: 0px;'>";
			html += "	<lable   class='labelFont'>"+obj.title+"<lable>";
			html += " </div>";	  
			html +=	getUlHtml(obj.option,obj.isCheckBox);
			
			$("#content").html(html);
			//设置默认选中
		  setChecked(obj.id);	
	  }
	  
	  //获取选项
	  function getUlHtml(dataUl,isCheckBox){
	  		var ul = " <ul class='list-group'>";
	  			for (var i=0;i<dataUl.length;i++) {
	  				//设置下个选项的ID
	  				$("#content").attr('next',dataUl[i].nextSubjectId);
	  				ul += "<li class='list-group-item ' >";
	  				ul += 	"<div style='float: left;'>";
	  				if(isCheckBox==0){
	  					ul += 		"<input type='radio' name='optionsRadiosinline' value="+dataUl[i].id+" id="+dataUl[i].id+"  />";
	  				}else{
	  					ul += 		"<input type='checkbox' name='optionsRadiosinline'  value="+dataUl[i].id+"  id="+dataUl[i].id+" />";
	  				}
	  				ul += 	" </div>";	
	  				ul += 	" <div>";	
	  				ul += 		" <span class='checkbox-inline'>"+dataUl[i].title+"</span>";	
	  				ul += 	" </div>";	
	  				ul += " </li>";	
	  			}
			  ul +="</ul>";
			
			 return ul; 
	  }
	//上下页切换  
	function changeQuest(num){
		var val = $("#content").attr('num');
		var x = parseInt(val);  
		var  result = num+x;
		if(result>=0&&result<dataSource.length){
			subjectAnswer(num,result);
		}else if(result ==dataSource.length ){
			//切换到textare panel
			subjectAnswer(num,result);
		}
	}
	
	function subjectAnswer(num,result){
			//选中的答案
			var str="";
		     $("input[name='optionsRadiosinline']:checked").each(function(){
		      str+=$(this).val()+",";
		     })
		     if(str==""){
		    	 alert("请选择答案")
		     }else{
		    	 //记录选中的选中，并保持到答案列表中
		    	 str = str.substring(0,str.length-1);
		    	 changeAnswer($("#content").attr('now'),$("#content").attr('now')+":"+str);
// 		    	 if(answer!=""){
		    		
// // 		    		 answer  =  answer +";"+$("#content").attr('now')+":"+str;
// 		    	 }else{
// 		    		 answer =$("#content").attr('now')+":"+str;
// 		    	 }
		    	 if(num==1){
		    		 //如果是下一页 则把当前的ID 作为上一页的ID
			    	 $("#content").attr('pre', $("#content").attr('now')); 
		    	 }else{
		    		 //如果是上一页 则把当前的ID 作为下一页的ID
			    	 $("#content").attr('next', $("#content").attr('now'));
		    	 }
		    	 getQuest(result);
				$("#content").attr('num',result);
		     }
	}
	
	//题目Id设置默认默认选中
	function setChecked(subjectId){
		//判断答案中是否存在改题目Id
		if(answer.indexOf(subjectId)!=-1){
			//获取题目和答案的数组 subjectID:optionId
			 var items= new Array();   
			 items = answer.split(";");
			if(items!=null&&items.length>0){
				for(var i=0;i<items.length;i++){
					var obj = items[i];
					 var options= new Array();   
					 options = obj.split(":");
					//如果答案中有这个题目ID 则进行设置默认选中
					if(subjectId==options[0]){
						var optionsId = options[1];
						//可能是多选
						var ids= new Array();   
							ids = optionsId.split(",");
						for(var j=0;j<ids.length;j++){
							var option = ids[i];
							$("#"+option).attr("checked","checked");
						}
					}
				}
			}
		}
	}
	
	
	function changeAnswer(subjectId,optionAnswer){
		//答案中是否已经存在这个答案
		if(answer.indexOf(subjectId)!=-1){
			 var items= new Array();   
			 items = answer.split(";");
			 if(items!=null&&items.length>0){
				 for(var i=0;i<items.length;i++){
						var obj = items[i];
						 var options= new Array();   
						 options = obj.split(":");
						 //如果答案中有这个题目ID 则替换结果
						 if(subjectId==options[0]){
							 items[i] = optionAnswer;
							 break;
						 }
				 }	
				 var result = "";
				 for(var i=0;i<items.length;i++){
						 if(i<items.length-1){
							 result +=items[i]+";";
						 }else{
							 result += items[i];
						 }
				 }	 
				 //将答案重新赋值
				 answer = result;
			 }
		}
		//如果不包含直接添加到结果中
		if(answer!=""){
			answer = answer+";"+optionAnswer;
		}else{
			answer = optionAnswer;
		}
		
	}
	
</script>
</html>